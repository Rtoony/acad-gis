<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pipe Network Editor | ACAD-GIS</title>
  <link rel="stylesheet" href="../shared/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="grid-background">
  <div id="root"></div>

  <script src="../shared/components.js"></script>
  <script src="../shared/react-components.js"></script>
  <script src="../shared/api.js"></script>

  <script type="text/babel">
    const { useEffect, useState } = React;
    const HeaderComp = window.Header || (({ title, subtitle }) => (
      React.createElement('header', { className: 'header' },
        React.createElement('div', { className: 'header-content' },
          React.createElement('div', { className: 'header-title' },
            React.createElement('h1', null, title || 'Pipe Network Editor'),
            subtitle && React.createElement('div', { className: 'header-subtitle' }, subtitle)
          )
        )
      )
    ));

    function PipeNetworkEditor() {
      const { useState, useEffect, useMemo } = React;
      const [networks, setNetworks] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState('');
      const [selected, setSelected] = useState(null);
      const [detail, setDetail] = useState(null);
      const [detailError, setDetailError] = useState('');
      const [loadingDetail, setLoadingDetail] = useState(false);
      const [validationResult, setValidationResult] = useState(null);
      const [validationLoading, setValidationLoading] = useState(false);
      const [validationStandards, setValidationStandards] = useState('default');
      const [showValidation, setShowValidation] = useState(false);
      const [showVisualizer, setShowVisualizer] = useState(false);

      const formatPercent = (value) => (value === null || value === undefined) ? '-' : `${(value * 100).toFixed(2)}%`;
      const formatNumber = (value) => (value === null || value === undefined) ? '-' : Number(value).toLocaleString();

      const fetchDetail = async (networkId, networkRow) => {
        if (!networkId) return;
        if (networkRow) setSelected(networkRow);
        setLoadingDetail(true);
        setDetailError('');
        try {
          const payload = await API.request('GET', `/pipe-networks/${networkId}/detail`);
          setDetail(payload);
        } catch (e) {
          setDetail(null);
          setDetailError(e.message || 'Failed to load network details');
        } finally {
          setLoadingDetail(false);
        }
      };

      const load = async (preserveSelection = false) => {
        setLoading(true); setError('');
        try {
          const data = await API.list('/pipe-networks');
          setNetworks(data || []);

          if (!data || !data.length) {
            setSelected(null);
            setDetail(null);
            return;
          }

          if (preserveSelection && selected) {
            const match = data.find(item => item.network_id === selected.network_id);
            if (match) {
              await fetchDetail(match.network_id, match);
              return;
            }
          }

          const first = data[0];
          await fetchDetail(first.network_id, first);
        } catch (e) {
          setError(e.message || 'Failed to load pipe networks');
          setNetworks([]);
          setSelected(null);
          setDetail(null);
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => { load(); }, []);

      const handleSelect = async (row) => {
        if (!row) return;
        if (selected && row.network_id === selected.network_id && detail) return;
        await fetchDetail(row.network_id, row);
      };

      const runValidation = async () => {
        if (!selected) return;
        setValidationLoading(true);
        try {
          const response = await API.request('POST', '/validate/pipe-network', {
            data: {
              network_id: selected.network_id,
              standards: validationStandards
            }
          });
          setValidationResult(response.result);
          setShowValidation(true);
        } catch (e) {
          alert('Validation failed: ' + (e.message || 'Unknown error'));
        } finally {
          setValidationLoading(false);
        }
      };

      const columns = [
        { key: 'name', label: 'Network' },
        { key: 'project_name', label: 'Project' },
        { key: 'pipe_count', label: 'Pipes', format: 'number' },
        { key: 'pipes_below_min', label: 'Below Min', format: 'number' },
        { key: 'avg_slope', label: 'Avg Slope', render: (value) => formatPercent(value) }
      ];

      const summaryCards = detail ? [
        { label: 'Total Pipes', value: formatNumber(detail.summary.pipe_count), icon: 'diagram-project' },
        { label: 'Below Minimum', value: formatNumber(detail.summary.pipes_below_min), icon: 'triangle-exclamation', accent: detail.summary.pipes_below_min ? '#ef4444' : '#22c55e' },
        { label: 'Average Slope', value: formatPercent(detail.summary.avg_slope), icon: 'percent' },
        { label: 'Worst Margin', value: detail.summary.worst_margin === null ? '-' : `${(detail.summary.worst_margin * 100).toFixed(2)}%`, icon: 'chart-line', accent: (detail.summary.worst_margin !== null && detail.summary.worst_margin < 0) ? '#ef4444' : '#22c55e' }
      ] : [];

      const renderSummaryCard = (card, idx) => (
        React.createElement('div', { key: idx, className: 'card' },
          React.createElement('div', { className: 'card-body flex items-center justify-between' },
            React.createElement('div', null,
              React.createElement('div', { style: { fontSize: '0.85rem', color: 'var(--color-text-muted)' } }, card.label),
              React.createElement('div', { style: { fontSize: '1.6rem', fontWeight: 600 } }, card.value)
            ),
            React.createElement('div', {
              style: {
                width: '48px',
                height: '48px',
                borderRadius: 'var(--radius-md)',
                background: 'rgba(59,130,246,0.15)',
                color: card.accent || '#3b82f6',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center'
              }
            },
              React.createElement('i', { className: `fas fa-${card.icon}` })
            )
          )
        )
      );

      const renderPipeRow = (pipe) => {
        const margin = pipe.slope_margin;
        const marginClass = margin !== null && margin < 0 ? { color: '#ef4444', fontWeight: 600 } : { color: '#22c55e' };
        return React.createElement('tr', { key: pipe.pipe_id },
          React.createElement('td', null, pipe.pipe_id.slice(0, 8) + '�'),
          React.createElement('td', null, pipe.diameter_mm ? `${Math.round(pipe.diameter_mm)} mm` : '-'),
          React.createElement('td', null, pipe.material || '-'),
          React.createElement('td', null, formatPercent(pipe.slope)),
          React.createElement('td', null, formatPercent(pipe.required_slope)),
          React.createElement('td', { style: marginClass }, margin === null ? '-' : formatPercent(margin)),
          React.createElement('td', null, pipe.length_m ? `${pipe.length_m.toFixed(1)} m` : '-'),
          React.createElement('td', null,
            React.createElement('span', {
              style: {
                display: 'inline-block',
                padding: '2px 8px',
                borderRadius: '999px',
                background: (margin !== null && margin < 0) ? 'rgba(239,68,68,0.15)' : 'rgba(34,197,94,0.15)',
                color: (margin !== null && margin < 0) ? '#ef4444' : '#22c55e',
                fontSize: '0.75rem',
                fontWeight: 600
              }
            }, (margin !== null && margin < 0) ? 'Review' : 'OK')
          )
        );
      };

      const renderStructureRow = (structure) => {
        return React.createElement('tr', { key: structure.structure_id },
          React.createElement('td', null, structure.structure_id.slice(0, 8) + '�'),
          React.createElement('td', null, structure.type || '-'),
          React.createElement('td', null, structure.metadata && structure.metadata.label ? structure.metadata.label : '-'),
          React.createElement('td', null, structure.rim_elev !== null ? structure.rim_elev.toFixed(2) : '-'),
          React.createElement('td', null, structure.latitude && structure.longitude ? `${structure.latitude.toFixed(5)}, ${structure.longitude.toFixed(5)}` : '-')
        );
      };

      const renderConflict = (conflict) => (
        React.createElement('li', { key: conflict.conflict_id, style: { marginBottom: '8px' } },
          React.createElement('strong', null, conflict.description),
          conflict.company ? ` � ${conflict.company}` : '',
          conflict.suggestions && conflict.suggestions.length ? React.createElement('div', { style: { fontSize: '0.8rem', color: 'var(--color-text-muted)' } }, `Suggestions: ${conflict.suggestions.join('; ')}`) : null
        )
      );

      const getSeverityColor = (severity) => {
        switch (severity) {
          case 'error': return '#ef4444';
          case 'warning': return '#f59e0b';
          case 'info': return '#3b82f6';
          default: return '#6b7280';
        }
      };

      const getSeverityIcon = (severity) => {
        switch (severity) {
          case 'error': return 'circle-xmark';
          case 'warning': return 'triangle-exclamation';
          case 'info': return 'circle-info';
          default: return 'circle';
        }
      };

      const renderValidationIssue = (issue, index) => {
        const color = getSeverityColor(issue.severity);
        const icon = getSeverityIcon(issue.severity);

        return React.createElement('div', {
          key: index,
          style: {
            padding: '12px',
            marginBottom: '8px',
            borderLeft: `4px solid ${color}`,
            background: 'rgba(255,255,255,0.05)',
            borderRadius: '4px'
          }
        },
          React.createElement('div', { style: { display: 'flex', alignItems: 'flex-start', gap: '12px' } },
            React.createElement('i', {
              className: `fas fa-${icon}`,
              style: { color, marginTop: '2px', fontSize: '16px' }
            }),
            React.createElement('div', { style: { flex: 1 } },
              React.createElement('div', { style: { fontWeight: 600, marginBottom: '4px' } },
                `[${issue.category.toUpperCase()}] ${issue.code}`
              ),
              React.createElement('div', { style: { marginBottom: '4px' } }, issue.message),
              (issue.pipe_id || issue.structure_id) && React.createElement('div', {
                style: { fontSize: '0.85rem', color: 'var(--color-text-muted)' }
              },
                issue.pipe_id && `Pipe: ${issue.pipe_id.slice(0, 8)}`,
                issue.structure_id && `Structure: ${issue.structure_id.slice(0, 8)}`
              ),
              (issue.expected_value !== null || issue.actual_value !== null) && React.createElement('div', {
                style: { fontSize: '0.85rem', marginTop: '4px', color: 'var(--color-text-muted)' }
              },
                issue.expected_value !== null && issue.expected_value !== undefined && `Expected: ${issue.expected_value.toFixed(2)}`,
                issue.expected_value !== null && issue.expected_value !== undefined && issue.actual_value !== null && issue.actual_value !== undefined && ' | ',
                issue.actual_value !== null && issue.actual_value !== undefined && `Actual: ${issue.actual_value.toFixed(2)}`
              )
            )
          )
        );
      };

      const renderNetworkVisualizer = () => {
        if (!detail || !detail.structures || !detail.pipes) return null;

        const structures = detail.structures;
        const pipes = detail.pipes;

        // Calculate bounds from structure coordinates
        const lats = structures.filter(s => s.latitude).map(s => s.latitude);
        const lons = structures.filter(s => s.longitude).map(s => s.longitude);

        if (lats.length === 0 || lons.length === 0) {
          return React.createElement('div', { className: 'card mt-md' },
            React.createElement('div', { className: 'card-body text-center p-lg' },
              'No coordinate data available for visualization'
            )
          );
        }

        const minLat = Math.min(...lats);
        const maxLat = Math.max(...lats);
        const minLon = Math.min(...lons);
        const maxLon = Math.max(...lons);

        const latRange = maxLat - minLat || 0.001;
        const lonRange = maxLon - minLon || 0.001;
        const padding = 50;
        const svgWidth = 1000;
        const svgHeight = 600;

        // Scale coordinates to SVG space
        const toX = (lon) => padding + ((lon - minLon) / lonRange) * (svgWidth - 2 * padding);
        const toY = (lat) => svgHeight - padding - ((lat - minLat) / latRange) * (svgHeight - 2 * padding);

        // Create structure lookup
        const structureMap = {};
        structures.forEach(s => {
          structureMap[s.structure_id] = s;
        });

        return React.createElement('div', { className: 'card mt-md' },
          React.createElement('div', { className: 'card-header' },
            React.createElement('div', {
              style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center' }
            },
              React.createElement('div', { className: 'card-title' }, 'Network Visualizer'),
              React.createElement('button', {
                className: 'btn btn-sm',
                onClick: () => setShowVisualizer(false)
              }, 'Close')
            )
          ),
          React.createElement('div', { className: 'card-body' },
            React.createElement('div', {
              style: {
                background: '#1e1e1e',
                borderRadius: '8px',
                padding: '20px',
                overflow: 'auto'
              }
            },
              React.createElement('svg', {
                viewBox: `0 0 ${svgWidth} ${svgHeight}`,
                style: { width: '100%', height: 'auto', minHeight: '500px' }
              },
                // Grid
                React.createElement('defs', null,
                  React.createElement('pattern', {
                    id: 'grid',
                    width: '50',
                    height: '50',
                    patternUnits: 'userSpaceOnUse'
                  },
                    React.createElement('path', {
                      d: 'M 50 0 L 0 0 0 50',
                      fill: 'none',
                      stroke: '#333',
                      strokeWidth: '1'
                    })
                  )
                ),
                React.createElement('rect', { width: svgWidth, height: svgHeight, fill: 'url(#grid)' }),

                // Pipes
                pipes.map((pipe, idx) => {
                  const upStruct = structureMap[pipe.up_structure_id];
                  const downStruct = structureMap[pipe.down_structure_id];

                  if (!upStruct || !downStruct || !upStruct.latitude || !downStruct.latitude) return null;

                  const x1 = toX(upStruct.longitude);
                  const y1 = toY(upStruct.latitude);
                  const x2 = toX(downStruct.longitude);
                  const y2 = toY(downStruct.latitude);
                  const midX = (x1 + x2) / 2;
                  const midY = (y1 + y2) / 2;

                  const diameter = pipe.diameter_mm ? `${Math.round(pipe.diameter_mm)}mm` : '?';
                  const slope = pipe.slope ? `${(pipe.slope * 100).toFixed(2)}%` : '?';
                  const length = pipe.length_m ? `${pipe.length_m.toFixed(1)}m` : '?';

                  return React.createElement('g', { key: `pipe-${idx}` },
                    // Pipe line
                    React.createElement('line', {
                      x1, y1, x2, y2,
                      stroke: '#3b82f6',
                      strokeWidth: '4',
                      strokeLinecap: 'round'
                    }),
                    // Pipe label background
                    React.createElement('rect', {
                      x: midX - 35,
                      y: midY - 18,
                      width: '70',
                      height: '36',
                      fill: '#1e1e1e',
                      stroke: '#3b82f6',
                      strokeWidth: '1',
                      rx: '4'
                    }),
                    // Pipe labels
                    React.createElement('text', {
                      x: midX,
                      y: midY - 4,
                      fill: '#3b82f6',
                      fontSize: '10',
                      fontWeight: '600',
                      textAnchor: 'middle'
                    }, diameter),
                    React.createElement('text', {
                      x: midX,
                      y: midY + 8,
                      fill: '#94a3b8',
                      fontSize: '8',
                      textAnchor: 'middle'
                    }, `L:${length}`),
                    React.createElement('text', {
                      x: midX,
                      y: midY + 18,
                      fill: '#94a3b8',
                      fontSize: '8',
                      textAnchor: 'middle'
                    }, `S:${slope}`)
                  );
                }),

                // Structures
                structures.filter(s => s.latitude && s.longitude).map((struct, idx) => {
                  const x = toX(struct.longitude);
                  const y = toY(struct.latitude);
                  const label = struct.metadata && struct.metadata.label ? struct.metadata.label : struct.structure_id.slice(0, 8);
                  const rimElev = (struct.rim_elev !== null && struct.rim_elev !== undefined) ? struct.rim_elev.toFixed(2) : '-';
                  const invertElev = (struct.invert_elev !== null && struct.invert_elev !== undefined) ? struct.invert_elev.toFixed(2) : '-';

                  return React.createElement('g', { key: `struct-${idx}` },
                    // Structure circle
                    React.createElement('circle', {
                      cx: x,
                      cy: y,
                      r: '12',
                      fill: '#ef4444',
                      stroke: '#fff',
                      strokeWidth: '2'
                    }),
                    // Structure type icon
                    React.createElement('text', {
                      x,
                      y: y + 4,
                      fill: '#fff',
                      fontSize: '12',
                      fontWeight: 'bold',
                      textAnchor: 'middle'
                    }, struct.type === 'manhole' ? 'MH' : 'IN'),
                    // Label background
                    React.createElement('rect', {
                      x: x - 45,
                      y: y + 18,
                      width: '90',
                      height: '48',
                      fill: '#1e1e1e',
                      stroke: '#ef4444',
                      strokeWidth: '1',
                      rx: '4'
                    }),
                    // Structure labels
                    React.createElement('text', {
                      x,
                      y: y + 30,
                      fill: '#f87171',
                      fontSize: '10',
                      fontWeight: '600',
                      textAnchor: 'middle'
                    }, label),
                    React.createElement('text', {
                      x,
                      y: y + 42,
                      fill: '#94a3b8',
                      fontSize: '8',
                      textAnchor: 'middle'
                    }, `Rim: ${rimElev}`),
                    React.createElement('text', {
                      x,
                      y: y + 54,
                      fill: '#94a3b8',
                      fontSize: '8',
                      textAnchor: 'middle'
                    }, `Inv: ${invertElev}`)
                  );
                })
              )
            ),
            React.createElement('div', {
              style: {
                marginTop: '16px',
                padding: '12px',
                background: 'rgba(255,255,255,0.05)',
                borderRadius: '4px',
                display: 'flex',
                gap: '24px',
                fontSize: '0.85rem'
              }
            },
              React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '8px' } },
                React.createElement('div', {
                  style: {
                    width: '16px',
                    height: '16px',
                    borderRadius: '50%',
                    background: '#ef4444',
                    border: '2px solid #fff'
                  }
                }),
                React.createElement('span', null, 'Structures')
              ),
              React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '8px' } },
                React.createElement('div', {
                  style: {
                    width: '24px',
                    height: '4px',
                    background: '#3b82f6',
                    borderRadius: '2px'
                  }
                }),
                React.createElement('span', null, 'Pipes')
              ),
              React.createElement('div', { style: { marginLeft: 'auto', color: 'var(--color-text-muted)' } },
                `${structures.length} structures, ${pipes.length} pipes`
              )
            )
          )
        );
      };

      const renderValidationResults = () => {
        if (!validationResult) return null;

        const { summary, issues, statistics, is_valid } = validationResult;

        const issuesByCategory = {
          continuity: issues.filter(i => i.category === 'continuity'),
          hydraulic: issues.filter(i => i.category === 'hydraulic'),
          standards: issues.filter(i => i.category === 'standards'),
          topology: issues.filter(i => i.category === 'topology'),
          geometry: issues.filter(i => i.category === 'geometry')
        };

        return React.createElement('div', { className: 'card mt-md' },
          React.createElement('div', { className: 'card-header' },
            React.createElement('div', {
              style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center' }
            },
              React.createElement('div', { className: 'card-title' }, 'Comprehensive Validation Results'),
              React.createElement('button', {
                className: 'btn btn-sm',
                onClick: () => setShowValidation(false)
              }, 'Close')
            )
          ),
          React.createElement('div', { className: 'card-body' },
            React.createElement('div', { className: 'grid grid-cols-4 gap-md mb-md' },
              React.createElement('div', {
                style: {
                  padding: '16px',
                  background: is_valid ? 'rgba(34,197,94,0.1)' : 'rgba(239,68,68,0.1)',
                  borderRadius: '8px',
                  border: `2px solid ${is_valid ? '#22c55e' : '#ef4444'}`
                }
              },
                React.createElement('div', { style: { fontSize: '0.85rem', marginBottom: '4px', color: 'var(--color-text-muted)' } }, 'Status'),
                React.createElement('div', { style: { fontSize: '1.5rem', fontWeight: 700, color: is_valid ? '#22c55e' : '#ef4444' } },
                  React.createElement('i', { className: `fas fa-${is_valid ? 'check-circle' : 'times-circle'}`, style: { marginRight: '8px' } }),
                  is_valid ? 'Valid' : 'Issues Found'
                )
              ),
              React.createElement('div', {
                style: { padding: '16px', background: 'rgba(239,68,68,0.1)', borderRadius: '8px' }
              },
                React.createElement('div', { style: { fontSize: '0.85rem', marginBottom: '4px', color: 'var(--color-text-muted)' } }, 'Errors'),
                React.createElement('div', { style: { fontSize: '1.5rem', fontWeight: 700, color: '#ef4444' } },
                  summary.errors
                )
              ),
              React.createElement('div', {
                style: { padding: '16px', background: 'rgba(245,158,11,0.1)', borderRadius: '8px' }
              },
                React.createElement('div', { style: { fontSize: '0.85rem', marginBottom: '4px', color: 'var(--color-text-muted)' } }, 'Warnings'),
                React.createElement('div', { style: { fontSize: '1.5rem', fontWeight: 700, color: '#f59e0b' } },
                  summary.warnings
                )
              ),
              React.createElement('div', {
                style: { padding: '16px', background: 'rgba(59,130,246,0.1)', borderRadius: '8px' }
              },
                React.createElement('div', { style: { fontSize: '0.85rem', marginBottom: '4px', color: 'var(--color-text-muted)' } }, 'Info'),
                React.createElement('div', { style: { fontSize: '1.5rem', fontWeight: 700, color: '#3b82f6' } },
                  summary.info
                )
              )
            ),

            statistics && React.createElement('div', { className: 'mb-md', style: { padding: '16px', background: 'rgba(255,255,255,0.05)', borderRadius: '8px' } },
              React.createElement('h4', { style: { marginBottom: '12px' } }, 'Network Statistics'),
              React.createElement('div', { className: 'grid grid-cols-3 gap-md' },
                React.createElement('div', null,
                  React.createElement('div', { style: { fontSize: '0.85rem', color: 'var(--color-text-muted)' } }, 'Total Pipes'),
                  React.createElement('div', { style: { fontSize: '1.25rem', fontWeight: 600 } }, statistics.total_pipes)
                ),
                React.createElement('div', null,
                  React.createElement('div', { style: { fontSize: '0.85rem', color: 'var(--color-text-muted)' } }, 'Total Length'),
                  React.createElement('div', { style: { fontSize: '1.25rem', fontWeight: 600 } },
                    statistics.total_length_ft ? `${statistics.total_length_ft.toFixed(0)} ft` : '-'
                  )
                ),
                React.createElement('div', null,
                  React.createElement('div', { style: { fontSize: '0.85rem', color: 'var(--color-text-muted)' } }, 'Avg Velocity'),
                  React.createElement('div', { style: { fontSize: '1.25rem', fontWeight: 600 } },
                    statistics.calculated_velocities_fps && statistics.calculated_velocities_fps.avg
                      ? `${statistics.calculated_velocities_fps.avg.toFixed(2)} fps`
                      : '-'
                  )
                )
              )
            ),

            summary.total_issues > 0 && React.createElement('div', null,
              React.createElement('h4', { style: { marginBottom: '12px' } }, 'Issues by Category'),
              Object.entries(issuesByCategory).map(([category, categoryIssues]) => {
                if (categoryIssues.length === 0) return null;
                return React.createElement('div', { key: category, style: { marginBottom: '24px' } },
                  React.createElement('h5', {
                    style: {
                      marginBottom: '12px',
                      padding: '8px 12px',
                      background: 'rgba(255,255,255,0.05)',
                      borderRadius: '4px',
                      textTransform: 'capitalize'
                    }
                  }, `${category} (${categoryIssues.length})`),
                  categoryIssues.map((issue, idx) => renderValidationIssue(issue, `${category}-${idx}`))
                );
              })
            ),

            summary.total_issues === 0 && React.createElement('div', {
              style: {
                padding: '32px',
                textAlign: 'center',
                color: '#22c55e'
              }
            },
              React.createElement('i', { className: 'fas fa-check-circle', style: { fontSize: '48px', marginBottom: '16px' } }),
              React.createElement('div', { style: { fontSize: '1.25rem', fontWeight: 600 } }, 'No Issues Found'),
              React.createElement('div', { style: { color: 'var(--color-text-muted)', marginTop: '8px' } },
                'All validation checks passed successfully!'
              )
            )
          )
        );
      };

      return (
        React.createElement('div', { className: 'page-wrapper' },
          React.createElement(HeaderComp, { title: 'Pipe Network Editor', subtitle: 'Manage pipe networks' }),
          React.createElement('main', { className: 'main-content' },
            React.createElement('div', { className: 'container' },
              React.createElement('div', { className: 'card' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('div', { className: 'card-title' }, 'Networks'),
                  React.createElement('div', null,
                    React.createElement('button', { className: 'btn btn-secondary', onClick: () => load(true) },
                      React.createElement('i', { className: 'fas fa-rotate' }), ' Refresh')
                  )
                ),
                error && React.createElement('div', { className: 'alert alert-danger mb-md' }, error),
                loading
                  ? React.createElement('div', { className: 'text-center p-lg' }, 'Loading...')
                  : React.createElement(window.DataTable || (({ data }) => React.createElement('pre', null, JSON.stringify(data, null, 2))), {
                      data: networks,
                      columns,
                      searchable: true,
                      pagination: true,
                      pageSize: 20,
                      emptyMessage: 'No networks found',
                      onRowClick: handleSelect
                    })
              ),
              selected && React.createElement('div', { className: 'card mt-md' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('div', { className: 'card-title' }, selected.name),
                  React.createElement('div', { className: 'text-muted' }, detail && detail.network ? detail.network.project_name : '')
                ),
                detailError && React.createElement('div', { className: 'alert alert-danger mb-md' }, detailError),
                loadingDetail
                  ? React.createElement('div', { className: 'text-center p-md' }, 'Loading network detail...')
                  : detail && React.createElement('div', { className: 'card-body' },
                      summaryCards.length > 0 && React.createElement('div', { className: 'grid grid-cols-4 gap-md mb-md' }, summaryCards.map(renderSummaryCard)),
                      React.createElement('div', { className: 'mb-md', style: { display: 'flex', gap: '12px', alignItems: 'center', flexWrap: 'wrap' } },
                        React.createElement('button', {
                          className: 'btn btn-primary',
                          onClick: runValidation,
                          disabled: validationLoading,
                          style: { display: 'flex', alignItems: 'center', gap: '8px' }
                        },
                          React.createElement('i', { className: `fas fa-${validationLoading ? 'spinner fa-spin' : 'check-circle'}` }),
                          validationLoading ? 'Validating...' : 'Run Comprehensive Validation'
                        ),
                        React.createElement('button', {
                          className: 'btn btn-secondary',
                          onClick: () => setShowVisualizer(!showVisualizer),
                          style: { display: 'flex', alignItems: 'center', gap: '8px' }
                        },
                          React.createElement('i', { className: 'fas fa-project-diagram' }),
                          showVisualizer ? 'Hide Visualizer' : 'Show Network Visualizer'
                        ),
                        React.createElement('select', {
                          value: validationStandards,
                          onChange: (e) => setValidationStandards(e.target.value),
                          className: 'input',
                          style: { maxWidth: '200px' }
                        },
                          React.createElement('option', { value: 'default' }, 'Default Standards'),
                          React.createElement('option', { value: 'strict' }, 'Strict Standards')
                        ),
                        validationResult && React.createElement('div', {
                          style: {
                            padding: '8px 12px',
                            borderRadius: '4px',
                            background: validationResult.is_valid ? 'rgba(34,197,94,0.1)' : 'rgba(239,68,68,0.1)',
                            color: validationResult.is_valid ? '#22c55e' : '#ef4444',
                            fontWeight: 600
                          }
                        },
                          React.createElement('i', { className: `fas fa-${validationResult.is_valid ? 'check-circle' : 'exclamation-triangle'}`, style: { marginRight: '8px' } }),
                          validationResult.is_valid ? 'Network Valid' : `${validationResult.summary.errors} Errors, ${validationResult.summary.warnings} Warnings`
                        )
                      ),
                      detail.pipes && detail.pipes.length > 0 && React.createElement('div', { className: 'mb-lg' },
                        React.createElement('h3', { style: { marginBottom: '0.5rem' } }, 'Pipes'),
                        React.createElement('div', { className: 'datatable-container' },
                          React.createElement('table', { className: 'datatable' },
                            React.createElement('thead', null,
                              React.createElement('tr', null,
                                ['ID', 'Diameter', 'Material', 'Slope', 'Required', 'Margin', 'Length', 'Status'].map((label, idx) => React.createElement('th', { key: idx }, label))
                              )
                            ),
                            React.createElement('tbody', null, detail.pipes.map(renderPipeRow))
                          )
                        )
                      ),
                      detail.structures && detail.structures.length > 0 && React.createElement('div', { className: 'mb-lg' },
                        React.createElement('h3', { style: { marginBottom: '0.5rem' } }, 'Structures'),
                        React.createElement('div', { className: 'datatable-container' },
                          React.createElement('table', { className: 'datatable' },
                            React.createElement('thead', null,
                              React.createElement('tr', null,
                                ['ID', 'Type', 'Label', 'Rim Elev.', 'Location'].map((label, idx) => React.createElement('th', { key: idx }, label))
                              )
                            ),
                            React.createElement('tbody', null, detail.structures.map(renderStructureRow))
                          )
                        )
                      ),
                      detail.conflicts && detail.conflicts.length > 0 && React.createElement('div', { className: 'mb-lg' },
                        React.createElement('h3', null, 'Conflicts'),
                        React.createElement('ul', { style: { paddingLeft: '18px' } }, detail.conflicts.map(renderConflict))
                      ),
                      detail.notes && detail.notes.length > 0 && React.createElement('div', null,
                        React.createElement('h3', null, 'Project Notes'),
                        React.createElement('ul', { style: { paddingLeft: '18px' } }, detail.notes.map(note => (
                          React.createElement('li', { key: note.note_id, style: { marginBottom: '6px' } },
                            React.createElement('strong', null, note.title),
                            ` � ${note.text}`
                          )
                        )))
                      )
                    )
              ),
              showVisualizer && renderNetworkVisualizer(),
              showValidation && renderValidationResults()
            )
          )
        )
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(PipeNetworkEditor));
  </script>
</body>
</html>
