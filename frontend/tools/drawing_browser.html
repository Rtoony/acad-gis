<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drawing Browser | ACAD-GIS</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="grid-background">
  <div id="root"></div>

  <script src="../shared/components.js"></script>
  <script src="../shared/react-components.js"></script>
  <script src="../shared/api.js"></script>
  <script type="text/babel">
    const { useEffect, useState } = React;
    const HeaderComp = window.Header || (({ title, subtitle }) => (
      React.createElement('header', { className: 'header' },
        React.createElement('div', { className: 'header-content' },
          React.createElement('div', { className: 'header-title' },
            React.createElement('h1', null, title || 'Drawing Browser'),
            subtitle && React.createElement('div', { className: 'header-subtitle' }, subtitle)
          )
        )
      )
    ));
    const DataTableComp = window.DataTable || (({ data }) => React.createElement('pre', null, JSON.stringify(data, null, 2)));
    const apiClient = window.API || { list: async () => [] };

    function DrawingBrowser() {
      const [projects, setProjects] = useState([]);
      const [projectId, setProjectId] = useState('');
      const [drawings, setDrawings] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        (async () => {
          try { setProjects(await apiClient.list('/projects')); }
          catch {}
        })();
      }, []);

      useEffect(() => {
        (async () => {
          setLoading(true);
          try {
            if (projectId) {
              setDrawings(await apiClient.list(`/projects/${projectId}/drawings`));
            } else {
              setDrawings(await apiClient.list('/drawings'));
            }
          } catch (e) { console.warn('Failed to load drawings', e); }
          setLoading(false);
        })();
      }, [projectId]);

      const columns = [
        { key: 'drawing_number', label: 'Number', sortable: true },
        { key: 'drawing_name', label: 'Name', sortable: true },
        { key: 'drawing_type', label: 'Type', sortable: true },
        { key: 'scale', label: 'Scale', sortable: true },
        { key: 'created_at', label: 'Created', format: 'date', sortable: true }
      ];

      return (
        React.createElement('div', { className: 'page-wrapper' },
          React.createElement(HeaderComp, { title: 'Drawing Browser', subtitle: 'Search and filter drawings' }),
          React.createElement('main', { className: 'main-content' },
            React.createElement('div', { className: 'container' },
              React.createElement('div', { className: 'card mb-lg' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('div', { className: 'card-title' }, 'Filters'),
                  React.createElement('div', null,
                    React.createElement('select', { className: 'input', value: projectId, onChange: (e) => setProjectId(e.target.value) },
                      React.createElement('option', { value: '' }, 'All projects'),
                      projects.map(p => React.createElement('option', { key: p.project_id, value: p.project_id }, `${p.project_number || '—'} — ${p.project_name}`))
                    )
                  )
                )
              ),
              React.createElement('div', { className: 'card' },
                loading
                  ? React.createElement('div', { className: 'card-body' }, 'Loading…')
                  : React.createElement('div', { className: 'card-body' },
                      React.createElement(DataTableComp, { data: drawings, columns, pageSize: 25 })
                    )
              )
            )
          )
        )
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(DrawingBrowser));
  </script>
</body>
</html>
